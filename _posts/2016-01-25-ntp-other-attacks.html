---
layout: post
title: Other Attacks using Delorean
date: '2016-01-25T07:36:00.000+01:00'
author: Jose Selvi
tags:
- DEFCON
- NTP
- Tools
- MitM
- Delorean
modified_time: '2016-01-25T07:36:19.153+01:00'
thumbnail: http://2.bp.blogspot.com/-C7JNeqQK348/VqSSmd7YTVI/AAAAAAAACH4/cyzv066Zdh4/s72-c/sched1.png
blogger_id: tag:blogger.com,1999:blog-9163961975500012189.post-1631515246125682257
blogger_orig_url: http://www.en.pentester.es/2016/01/ntp-other-attacks.html
---

<div style="text-align: justify;">Have a look to other posts of this serie:<br /><br /><div style="text-align: justify;"><a href="https://www.pentester.es/delorean/" target="_blank">[1] NTP MitM Attack using a Delorean</a></div><div style="text-align: justify;"><a href="https://www.pentester.es/ntp-macosx/" target="_blank">[2] Mac OS X Time Synchronization</a></div><div style="text-align: justify;"><a href="https://www.pentester.es/ntp-linux/" target="_blank">[3] Fedora / Ubuntu Time Synchronization</a></div><div style="text-align: justify;"><a href="https://www.pentester.es/ntp-microsoft/" target="_blank">[4] Microsoft Time Synchronization</a></div><div style="text-align: justify;"><a href="https://www.pentester.es/ntp-hsts/" target="_blank">[5] Attacking HTTP Strict Transport Security</a></div><div style="text-align: justify;"><a href="https://www.pentester.es/ntp-pki/" target="_blank">[6] Attacking the Public Key Infrastructure</a></div><a href="https://www.pentester.es/ntp-other-attacks/" target="_blank">[7] Other Attacks</a><br />[8] Helper tools<br /><br />Disclaimer: All this information has been obtained from  empirical tests and in a specific period of time, so they could have  changed.</div><div style="text-align: justify;"><br />The attacks shown in the previous posts are the ones that I considered more likely and with biggest impact. However, I was trying other exploitation opportunities using time synchronization attacks. Some of them worked even being unlikely, and some others didn't work at all.<br /><br />One of the attacks that worked was an attack against the Windows Task Scheduler. As you probably know, there is a service in Windows boxes that run certain maintenance tasks in the background, such as the same time synchronization.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-C7JNeqQK348/VqSSmd7YTVI/AAAAAAAACH4/cyzv066Zdh4/s1600/sched1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="283" src="http://2.bp.blogspot.com/-C7JNeqQK348/VqSSmd7YTVI/AAAAAAAACH4/cyzv066Zdh4/s400/sched1.png" width="400" /></a></div><br />The task scheduler keeps information about the last time when the task was ran and the next time it will do. These fields are important because, depending on the task configuration, "Next Run Time" is sometimes calculated based on the "Last Run time", which gives us the opportunity to manipulate the next run time by manipulating the clock using Delorean.<br /><br />As I said, not all the tasks calculate "Next Run Time" in this way, but there are some interesting tasks that do, for example the Windows Automatic Updated Service.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-GpymquDWcpQ/VqSU-dT9yfI/AAAAAAAACIE/dtyUhAersNU/s1600/sched2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="263" src="http://4.bp.blogspot.com/-GpymquDWcpQ/VqSU-dT9yfI/AAAAAAAACIE/dtyUhAersNU/s400/sched2.png" width="400" /></a></div><br />So, What happen if we manipulate the the clock using Delorean, as we did in previous posts, and the Windows Automatic Update task is executed? The "Last Run Time" field would be updated to the fake date (let's said 2020), so the "Next Run Time" would be calculated in base of that date, in other words, at some point in 2020. That should't be a problem if the system would maintain that fake date forever, but if the clock is restored to the real date... then the next Windows Automatic Update will take place in 4 years, so the users wouldn't be warned about new updates and fixes if they don't manually check it.<br /><br />This is an unlikely attack because Windows is the mosts unlikely platform to be a victim for a Delorean attack, and because I couldn't find a way to restore the clock without user intervention. However, other tasks and other platforms (cron in Linux, for example) could be abused in the same way.</div>