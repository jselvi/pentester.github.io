---
layout: post
title: Helper tools for Delorean
date: '2016-01-26T09:00:00.000+01:00'
author: Jose Selvi
tags:
- DEFCON
- NTP
- Tools
- MitM
- Delorean
modified_time: '2016-01-26T09:00:06.521+01:00'
thumbnail: http://4.bp.blogspot.com/-dPB5N3qGo4w/VqTKPn5gg_I/AAAAAAAACIw/2VbBq4NnNd4/s72-c/certOK.png
blogger_id: tag:blogger.com,1999:blog-9163961975500012189.post-8288348608376780359
blogger_orig_url: http://www.en.pentester.es/2016/01/ntp-helper-tools.html
---

<div style="text-align: justify;">Have a look to other posts of this serie:<br /><br /><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/10/delorean.html" target="_blank">[1] NTP MitM Attack using a Delorean</a></div><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/10/ntp-macosx.html" target="_blank">[2] Mac OS X Time Synchronization</a></div><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/10/ntp-linux.html" target="_blank">[3] Fedora / Ubuntu Time Synchronization</a></div><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/10/ntp-microsoft.html" target="_blank">[4] Microsoft Time Synchronization</a></div><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/11/ntp-hsts.html" target="_blank">[5] Attacking HTTP Strict Transport Security</a></div><div style="text-align: justify;"><a href="http://www.en.pentester.es/2015/11/ntp-pki.html" target="_blank">[6] Attacking the Public Key Infrastructure</a></div><a href="http://www.en.pentester.es/2016/01/ntp-other-attacks.html" target="_blank">[7] Other Attacks</a><br />[8] Helper tools<br /><br />Disclaimer: All this information has been obtained from  empirical tests and in a specific period of time, so they could have  changed.</div><div style="text-align: justify;"><div style="text-align: justify;"><br /></div><div style="text-align: justify;">We are finally in the last post of this serie about Deloran. At this point, I have talked about the attacks that were tested, about the tool and many other things. However, if you pay attention to the <a href="https://github.com/pentesteres/delorean" target="_blank">Delorean repository</a>, you will see that there are &nbsp;couple of additional python scripts there. They are small tools that I created as a helper tools, because I needed a feature but I didn't make sense to integrate it with Delorean, so I keep them as separate tools.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The first one is <a href="https://github.com/PentesterES/Delorean/blob/master/hsts_catcher.py" target="_blank">hsts_catcher.py</a> which is a simple tools that just connects to a website an returns its HSTS configuration. Nothing that you couldn't do with curl and grep:</div><br /><div style="text-align: left;"><i>$ <b>./hsts_catcher.py -U https://accounts.google.com -A "Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 6.0)"</b></i></div><div style="text-align: left;"><i>max-age=10893354; includeSubDomains</i></div><br /><div style="text-align: justify;">The second tools is <a href="https://github.com/PentesterES/Delorean/blob/master/crl_checker.py" target="_blank">crl_checker.py</a> which is much cooler than hits_catcher.py. When I was looking for certificates that I could use, I faced a big problem: Some certificates that I found had issues in their certificate chain, for example it root CA was expired or similar problems. Unfortunately, checking all possible issues is <strike>a pain in the ass</strike> a manual process that can take valuable time, so the most convenient option was to use a browser to check if the certificate chain was valid or no. However, I had another problem here: A web server needs both the certificate and the private key, and to find the private key is the hardest part here, so I prefer to do it only for those certificates where I know I will be successful in advance. It seemed the egg and the chicken problem.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">That's why crl_checker.py was born. It implements the first stages of the SSL handshake, where the private key is not really needed before the certificate validation, so we can check it just using our browser and running the following command:</div><div style="text-align: justify;"><br style="text-align: start;" /><span style="text-align: start;"><i>$ <b>./crl_checker.py -p 10443 -c /etc/apache2/ssl/ietf.crt</b></i></span></div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-dPB5N3qGo4w/VqTKPn5gg_I/AAAAAAAACIw/2VbBq4NnNd4/s1600/certOK.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="273" src="http://4.bp.blogspot.com/-dPB5N3qGo4w/VqTKPn5gg_I/AAAAAAAACIw/2VbBq4NnNd4/s400/certOK.png" width="400" /></a></div><div style="text-align: justify;"><br /></div>Sometimes you need to refresh several times to have this warning message. Probably my SSL handshake implementation is too much hardcoded, but I haven't go in depth of this since the tool is still useful.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">You will always see a warning message even if the certificate chain is perfect, because you are not connecting to the correct hostname, but this doesn't really matters. There are other warning messages that doesn't matter as well, such us the expiration one, since we will use Delorean to bypass this. If you only have these warning messages... that's great! your certificate can be used for a successful attack. Now you need to get the private key as we did in previous posts.</div><div style="text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-fAvGuv3WX_A/VqTL3I_Y8yI/AAAAAAAACI4/oe3tyeK0UtY/s1600/certFAIL.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="293" src="http://3.bp.blogspot.com/-fAvGuv3WX_A/VqTL3I_Y8yI/AAAAAAAACI4/oe3tyeK0UtY/s400/certFAIL.png" width="400" /></a></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">If you aren't lucky, you will see other warning messages such as "the issuer certificate is unknown" which means that the issuer CA was removed from trusted CAs list or other similar issues. You probably should try with another victim.</div>